#[How To Change Your App Icon at Build Time](https://www.raywenderlich.com/105641/change-app-icon-build-time)

##Add toos:
```
 brew install ImageMagick
 brew install ghostscript
 brew doctor
```
##Conver and Composite 

- Conver: take an image and modifies it,then save as a new
- Compositie: combine two image together,save as third

Add text to image 

```
convert AppIcon60x60@2x.png -fill white -font Times-Bold -pointsize 18 -gravity south -annotate 0 "Hello World" test.png
```
- AppIcon60x60@2x.png is the input image’s file name;
- fill white sets the text’s fill color to white;
- font Times-Bold instructs ImageMagick to use the bold variant of the Times typeface for any text;
- pointsize 18 sets the font size to 18 pixels;
- gravity south means any text generated by the command will be aligned at the bottom of the image
- annotate 0 “Hello World” tells ImageMagick to annotate the image with the text Hello World at an angle of 0 degrees;
test.png is the name of the output file,and ImageMagick will overwrite the existing file if it already exists.

Check supported Font

```
convert -list font
```
Change Size

```
convert betaRibbon.png -resize 120x120 smallBetaRibbon.png
```
Combine

```
composite smallBetaRibbon.png test.png test2.png
```

Shell

```
echo "${BUILT_PRODUCTS_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}"
echo "${SRCROOT}"
```

[many build settings’ variables](https://developer.apple.com/legacy/library/documentation/DeveloperTools/Reference/XcodeBuildSettingRef/0-Introduction/introduction.html)

Find Soure Path

```
IFS=$'\n'
echo $(find ${SRCROOT} -name "AppIcon60x60@2x.png")
```
脚本处理完后的图片添加到ipa 中

```
IFS=$'\n'
buildNumber=$(/usr/libexec/PlistBuddy -c "Print CFBundleVersion" "${PROJECT_DIR}/${INFOPLIST_FILE}")
versionNumber=$(/usr/libexec/PlistBuddy -c "Print CFBundleShortVersionString" "${PROJECT_DIR}/${INFOPLIST_FILE}")
PATH=${PATH}:/usr/local/bin

function generateIcon () {
    BASE_IMAGE_NAME=$1
    
    TARGET_PATH="${BUILT_PRODUCTS_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}/${BASE_IMAGE_NAME}"
    echo $TARGET_PATH
    echo $SRCROOT
    echo $(find ${SRCROOT} -name "AppIcon60x60@2x.png")
    BASE_IMAGE_PATH=$(find ${SRCROOT} -name ${BASE_IMAGE_NAME})
    WIDTH=$(identify -format %w ${BASE_IMAGE_PATH})
    FONT_SIZE=$(echo "$WIDTH * .15" | bc -l)
    echo "font size $FONT_SIZE"
    
    if [ "${CONFIGURATION}" == "Debug" ]; then
    convert debugRibbon.png -resize ${WIDTH}x${WIDTH} resizedRibbon.png
    convert ${BASE_IMAGE_PATH} -fill white -font Times-Bold -pointsize ${FONT_SIZE} -gravity south -annotate 0 "$buildNumber" - | composite resizedRibbon.png - ${TARGET_PATH}
    fi
    
    if [ "${CONFIGURATION}" == "Beta" ]; then
    convert betaRibbon.png -resize ${WIDTH}x${WIDTH} resizedRibbon.png
    convert ${BASE_IMAGE_PATH} -fill white -font Times-Boldr -pointsize ${FONT_SIZE} -gravity south -annotate 0 "$buildNumber" - | composite resizedRibbon.png - ${TARGET_PATH}
    fi
}

generateIcon "AppIcon60x60@2x.png"
generateIcon "AppIcon60x60@3x.png"

```

获取版本号：

```
buildNumber=$(/usr/libexec/PlistBuddy -c "Print CFBundleVersion" "${PROJECT_DIR}/${INFOPLIST_FILE}")

```
## 总结

主要功能是实现不run 模式下：（debug release beta）App Icon 的变化
通过  icon 标识了 App 的版本 和类型。

办法 是 通过 commandline 工具 从xcode Image 资源中合并与转化成新的图片 替换 ipa boundle 中的 资源资源图片

